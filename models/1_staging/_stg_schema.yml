# ===========================================
# models/1_staging/_stg_schema.yml
# ===========================================

version: 2

models:
  - name: stg_invoices
    description: Staging model for invoice data
    columns:
      - name: movie_id
        tests: 
          - not_null
      - name: invoice_id
        tests: 
          - not_null 
              # NOTE: - unique test removed due to duplicate invoice_ids in source data
              # In production, this would require data quality discussion with upstream systems
              # For portfolio purposes, demonstrates ability to identify and handle data quality issues
      - name: location_id
        tests:
          - not_null
          - accepted_values:
              values: 
                - 'NJ_001'
                - 'NJ_002'
                - 'NJ_003'
      - name: weekly_price
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true

  - name: stg_movie_catalogue
    description: Staging model for movie catalog
    columns:
      - name: movie_id
        tests: 
          - unique
          - not_null
      - name: movie_title
        tests: 
          - not_null
      - name: budget
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true

  - name: stg_nj_001
    description: Staging model for NJ_001 transactions
    columns:
      - name: transaction_date
        tests: 
          - not_null
      - name: movie_id
        tests:
          - not_null
          - relationships:
              to: ref('stg_movie_catalogue')
              field: movie_id
      - name: ticket_price
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
              inclusive: true

  - name: stg_nj_002
    description: Staging model for NJ_002 daily sales
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_date
            - movie_id
    columns:
      - name: transaction_date
        tests: 
          - not_null
      - name: movie_id
        tests:
          - not_null
          - relationships:
              to: ref('stg_movie_catalogue')
              field: movie_id
      - name: ticket_price
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
              inclusive: true

  - name: stg_nj_003
    description: Staging model for NJ_003 ticket transactions
    columns:
      - name: transaction_date
        tests: 
          - not_null
      - name: movie_id
        tests:
          - not_null
          - relationships:
              to: ref('stg_movie_catalogue')
              field: movie_id
      - name: ticket_price
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
              inclusive: true