version: 2

models:
  - name: int_costs_revenue_monthly
    description: Monthly aggregation of rental costs from Silver Screen invoice data, showing what theaters pay to rent movies from studios
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - movie_id
            - location_id
            - invoice_month
    columns:
      - name: movie_id
        description: Unique identifier for each movie
        tests:
          - not_null
      - name: location_id
        description: Theater location identifier
        tests:
          - not_null
      - name: studio
        description: Production studio responsible for the movie
        tests:
          - not_null
      - name: invoice_month
        description: Month of the invoice, truncated from invoice_date
        tests:
          - not_null
      - name: sum_weekly_price
        description: Sum of weekly rental prices for the month
      - name: total_price
        description: Estimated total monthly rental cost (sum_weekly_price * 4)
      - name: count_invoices
        description: Number of invoices for this movie/location/month combination

  - name: int_nj_001_daily
    description: Daily aggregation of ticket sales from NJ_001 location, rolling up individual transactions to daily totals
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_date
            - location_id
            - movie_id
    columns:
      - name: transaction_date
        description: Date of the transactions
        tests:
          - not_null
      - name: location_id
        description: Theater location identifier (always 'NJ_001')
        tests:
          - not_null
          - accepted_values:
              values: ['NJ_001']
      - name: movie_id
        description: Unique identifier for each movie
        tests:
          - not_null
      - name: tickets_sold
        description: Total number of tickets sold on this date for this movie
      - name: revenue
        description: Total revenue generated on this date for this movie

  - name: int_nj_002_daily
    description: Daily ticket sales data from NJ_002 location, already aggregated at source so passed through with consistent structure
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_date
            - location_id
            - movie_id
    columns:
      - name: transaction_date
        description: Date of the ticket sales
        tests:
          - not_null
      - name: location_id
        description: Theater location identifier (always 'NJ_002')
        tests:
          - not_null
          - accepted_values:
              values: ['NJ_002']
      - name: movie_id
        description: Unique identifier for each movie
        tests:
          - not_null
      - name: tickets_sold
        description: Number of tickets sold on this date for this movie
      - name: revenue
        description: Revenue generated on this date for this movie

  - name: int_nj_003_daily
    description: Daily aggregation of ticket sales from NJ_003 location, filtering only ticket transactions and rolling up to daily totals
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_date
            - location_id
            - movie_id
    columns:
      - name: transaction_date
        description: Date of the transactions
        tests:
          - not_null
      - name: location_id
        description: Theater location identifier (always 'NJ_003')
        tests:
          - not_null
          - accepted_values:
              values: ['NJ_003']
      - name: movie_id
        description: Unique identifier for each movie
        tests:
          - not_null
      - name: tickets_sold
        description: Total number of tickets sold on this date for this movie
      - name: revenue
        description: Total revenue generated on this date for this movie

  - name: int_sales
    description: Union of all daily sales data from all NJ locations, providing a unified view of ticket sales across theaters
    columns:
      - name: transaction_date
        description: Date of the transactions
        tests:
          - not_null
      - name: location_id
        description: Theater location identifier
        tests:
          - not_null
          - accepted_values:
              values: ['NJ_001', 'NJ_002', 'NJ_003']
      - name: movie_id
        description: Unique identifier for each movie
        tests:
          - not_null
      - name: tickets_sold
        description: Number of tickets sold on this date for this movie at this location
      - name: revenue
        description: Revenue generated on this date for this movie at this location

  - name: int_sales_monthly
    description: Monthly aggregation of ticket sales across all locations, providing monthly totals per movie per location
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - movie_id
            - location_id
            - transaction_month
    columns:
      - name: movie_id
        description: Unique identifier for each movie
        tests:
          - not_null
      - name: location_id
        description: Theater location identifier
        tests:
          - not_null
      - name: transaction_month
        description: Month of the transactions, truncated from transaction_date
        tests:
          - not_null
      - name: total_tickets_sold
        description: Total number of tickets sold in this month for this movie at this location
      - name: total_revenue
        description: Total revenue generated in this month for this movie at this location